<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Pokemon Type Distribution</title>
		<script src="https://cdn.tailwindcss.com"></script>

		<script src="https://d3js.org/d3.v7.min.js"></script>
		<script src="https://unpkg.com/pokeapi-js-wrapper/dist/index.js"></script>
		<style>
			@keyframes fadeIn {
				0% {
					opacity: 0;
				}
				100% {
					opacity: 1;
				}
			}

			.fade-in {
				animation: fadeIn ease 1s;
			}
		</style>
	</head>
	<body
		class="fade-in bg-gray-100 flex flex-col items-center justify-center h-screen w-screen"
	>
		<div>
			<p class="text-4xl font-bold">Pokemon Data Visualization</p>
			<div
				class="flex justify-evenly bg-white items-center gap-2 m-2 mb-8 py-4 px-8 rounded-xl shadow-md"
			>
				<a href="spiderChart.html">Pie Chart</a>
				<a href="index.html">Bar Chart</a>
			</div>
		</div>
		<div class="bg-white p-6 rounded-lg shadow-lg">
			<h1 class="text-2xl text-center font-semibold mb-4">
				Pokémon Type Distribution
			</h1>
			<div id="pie-chart" class=""></div>
		</div>
		<script>
			const PokeAPI = new Pokedex.Pokedex()

			// Function to fetch Pokémon types data
			async function getPokemonTypes() {
				try {
					const response = await PokeAPI.getTypesList()
					const types = response.results

					// Make a separate request for each type to get the list of Pokémon of that type
					for (let type of types) {
						const typeData = await PokeAPI.getTypeByName(type.name)
						type.pokemon = typeData.pokemon
					}

					return types
				} catch (error) {
					console.error('Error fetching Pokémon types:', error)
				}
			}

			// Function to create pie chart
			async function createPieChart() {
				const types = await getPokemonTypes()

				const data = types.map((type) => ({
					name: type.name,
					count: type.pokemon.length,
				}))

				const width = 600
				const height = 600
				const radius = Math.min(width, height) / 2

				const svg = d3
					.select('#pie-chart')
					.append('svg')
					.attr('width', width)
					.attr('height', height)
					.append('g')
					.attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')')

				const color = d3.scaleOrdinal(d3.schemeCategory10)

				const pie = d3.pie().value(function (d) {
					return d.count
				})
				const path = d3
					.arc()
					.outerRadius(radius - 10)
					.innerRadius(0)

				const g = svg
					.selectAll('.arc')
					.data(pie(data))
					.enter()
					.append('g')
					.attr('class', 'arc')

				g.append('path')
					.attr('d', path)
					.style('fill', function (d) {
						return color(d.data.name)
					})
					.transition() // Start a transition
					.duration(1000) // Set the duration to 1000 milliseconds
					.style('opacity', 0) // Start from fully transparent
					.style('opacity', 1) // End at fully opaque

				g.append('text')
					.attr('transform', function (d) {
						return 'translate(' + path.centroid(d) + ')'
					})
					.attr('dy', '.35em')
					.style('text-anchor', 'middle')
					.text(function (d) {
						return d.data.name
					})
					.transition() // Start a transition
					.duration(1000) // Set the duration to 1000 milliseconds
					.style('opacity', 0) // Start from fully transparent
					.style('opacity', 1)
			}

			createPieChart()
		</script>
	</body>
</html>
